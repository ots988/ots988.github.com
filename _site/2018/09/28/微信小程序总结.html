<!-- 博文的布局-Layout -->
<!DOCTYPE html>
<html>
<head>
<!-- 引入head标签 -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-sclable=0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="description" content="Just for fun !" />
<meta name="keywords" content="徐金琦, 徐金琦的独立博客, 徐金琦的博客, 前端,  前端博客, javascript, 操作系统, ubuntu, 网络" />
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="stylesheet" href="/assets/css/media.css">
<link rel="stylesheet" href="/assets/css/animate.min.css">
<link rel="stylesheet" href="/assets/css/pygments/pygments_tango.css">
<link rel="stylesheet" href="/assets/css/github-markdown.css">
<!-- SNS-icon -->
<script src="//at.alicdn.com/t/font_856428_y9z6nq7zf5.js"></script>
<!-- share.css -->
<link rel="stylesheet" href="/assets/css/share.min.css">
<!-- font -->
<link rel="stylesheet" href="/assets/css/font.css">
<!-- <link href="https://fonts.googleapis.com/css?family=Kaushan+Script|Pacifico|Ubuntu|Roboto+Mono|Source+Sans+Pro" rel="stylesheet"> -->

<!-- Favicon -->
<link href="/assets/profile.jpeg" rel="shortcut icon" />
<link href="/assets/profile.jpeg" rel="apple-touch-icon-precomposed" />
<!-- Android Lolipop Theme Color -->
<!-- <meta name="theme-color" content="#1464FB"> -->
<title>微信小程序总结</title>
<!-- 百度统计 -->

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?efa555a0adb0eca621754fde118fb358";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>

<!-- 谷歌分析 -->


<!-- Android Lolipop Theme Color -->
<meta name="theme-color" content=" rgb(255,90,90) ">
</head>
<body>

<!-- 顶部锚点 -->
<a id="htmlup" name="htmlup"></a>
<!-- 引入博文顶部选项 -->

<header id="post-header" style="background-color:rgb(255,90,90);">
  <div class="top-center">
      <div class="logo">
          <a href="/" title="my awesome webtitle" style="color: white;">xSeven</a>
      </div>
      <nav class="top-nav">
          <ul>
              
                <li><a href="/" style="color: white;">首页</a></li>
              
                <li><a href="/tags.html" style="color: white;">标签</a></li>
              
                <li><a href="/timeline.html" style="color: white;">时间线</a></li>
              
                <li><a href="/about.html" style="color: white;">关于博主</a></li>
              
                <li><a href="/resume/index.html" style="color: white;">个人简历</a></li>
              
                <li><a href="/friendLink.html" style="color: white;">友情链接</a></li>
              
          </ul>
      </nav>
      <div id="top-boot">
        <a href="javascript:;" id="boot1" style="display:block;" onclick="document.getElementById('boot-area').style.display='block';document.getElementById('boot1').style.display='none';document.getElementById('boot2').style.display='block';"><img src="/assets/boot_white.png" alt=""></a>
        <a href="javascript:;" id="boot2" style="display: none;" onclick="document.getElementById('boot-area').style.display='none';document.getElementById('boot1').style.display='block';document.getElementById('boot2').style.display='none';"><img src="/assets/boot_white.png" alt=""></a>
      </div>
  </div>

</header>


<!-- 引入移动下拉选项 -->
<div id="boot-area">
    <ul>
        
          <a href="/"><li>首页</li></a>
        
          <a href="/tags.html"><li>标签</li></a>
        
          <a href="/timeline.html"><li>时间线</li></a>
        
          <a href="/about.html"><li>关于博主</li></a>
        
          <a href="/resume/index.html"><li>个人简历</li></a>
        
          <a href="/friendLink.html"><li>友情链接</li></a>
        
    </ul>
</div>

<!-- 引入博文顶部样式 -->
<!-- 版本一 垃圾 -->
<!-- <div class="wow fadeIn top" data-wow-duration="3.5s" >
    <span class="wow fadeInUp" data-wow-delay="0.2s">微信小程序总结</span>
    <span class="wow fadeInUp" data-wow-delay="0.4s"></span>
    <span class="wow fadeInUp" data-wow-delay="0.4s"></span>
    <span class="wow fadeInUp" data-wow-delay="0.6s">作者&nbsp;&nbsp;|&nbsp;&nbsp;true</span>
</div> -->

<!-- 版本二 可切换页面 -->

<div class="post-top" style="background-color:rgb(255,90,90);">
  <!-- 页面宽度大于800px -->
  <div class="left-area">
    
      <a href="javascript:;" class="btn bounceInLeft animated" onmouseover="showLeft();this.style.color='rgb(255,90,90)';" onmouseout="goneLeft();this.style.color='rgba(0,0,0,.2)';"><</a>
      <div id="left-tab" style="display:none;"><span class="left-san"></span><span class="left-main" style="color:rgb(255,90,90);"><sapn class="main">没有上一页咯</sapn></span></div>
    
  </div>
  <div class="post-titlearea">
    <span class="wow fadeInUp" data-wow-delay="0.2s">微信小程序总结</span>
    <!-- <span class="wow fadeInUp" data-wow-delay="0.4s"></span> -->
    <!-- <span class="wow fadeInUp" data-wow-delay="0.4s"></span> -->
    <!-- <span class="wow fadeInUp" data-wow-delay="0.6s">作者&nbsp;&nbsp;|&nbsp;&nbsp;true</span> -->
  </div>
  <div class="right-area">
    
      <a href="/2018/05/30/HardCandy-Jekyll.html" class="btn bounceInRight self-animated" onmouseover="showRight();this.style.color='rgb(255,90,90)';" onmouseout="goneRight();this.style.color='rgba(0,0,0,.2)';">></a>
      <div id="right-tab" style="display:none;"><span class="right-san"></span><span class="right-main" style="color:rgb(255,90,90);"><sapn class="main">HardCandy-Jekyll</sapn></span></div>
    
  </div>

  <!-- 页面宽度小于800px -->
  <div class="post-changearea">
    
      <a href="javascript:;" class="leftchange" style="border-right: 1px solid rgb(255,90,90);border-bottom: 2px solid rgb(255,90,90);"><span><br>没有上一篇咯</span></a>
    
    
      <a href="/2018/05/30/HardCandy-Jekyll.html" class="rightchange" style="border-left: 1px solid rgb(255,90,90);border-bottom: 2px solid rgb(255,90,90);"><span>下一篇<br><br>HardCandy-Jekyll</span></a>
    
  </div>
</div>


<div class="markdown-body fadeInUp animated">

  

  <!-- 文章内容 -->
  <h1 id="2018-09-27-学习工作总结微信小程序">2018-09-27 学习工作总结——微信小程序</h1>

<p>​	从之前写完这个 <a href="https://github.com/xukimseven/HardCandy-Jekyll">HardCandy-Jekyll</a> 主题以后就很少管理我的博客了。</p>

<blockquote>
  <p>ps：感谢给我提 <strong>issue</strong> 的小伙伴，也感谢给我 <strong>star</strong> 和 <strong>fork</strong> 我的主题仓库的小伙伴。我会继续努力专注前端的。</p>
</blockquote>

<p>​	这几天，正好有空，领导也让我自己写一篇总结性的文章总结一下最近的开发遇到的问题与解决方法，一不小心写成了博客的样子，着实尴尬。删删减减，留下了精华部分，然后交了上去。博客版本和上交版本还是不太一样的。</p>

<p>​	6月份开始找实习，6月25日正式上岗 <strong>web前端</strong> 。不多不少，忙忙碌碌下来，正好3个月过去了。3个月里，有时手忙脚乱，有时却也会闲着思考人生。作为一个前端小学生，怎么样才能够在这个行业内长久的立足下去，免不了的就是学习新技术啊。</p>

<p>​	进公司几个月以来，写了一个半（1.5）微信小程序，写了一个汽车商城后台管理平台，以及各种各样零碎的东西。说实话，工作后才发现，像以前会一点DOM操作简直弱爆了，能够熟练的掌握一些数据处理的相关技术才是前端基础。</p>

<p>​	关于小程序，原来有接触过，但写实从来没有写过一点小程序的代码。不过，从零学起，看着官方文档一天便可以上手。然而，上手以后的坑是避免不了的。</p>

<blockquote>
  <p>PS：由于 jekyll的源码和 微信小程序 或 vue 等框架的  “” 有冲突，具体的 wxml的代码可能会被认为是页面的源码而出现代码缺失。具体完整的代码需前往博客底部的，会有源码下载地址。</p>
</blockquote>

<ol>
  <li><a href="#小程序的请求地址">小程序的请求地址</a>
    <ul>
      <li><a href="#关于请求地址的公共部分统一存放方式">关于请求地址的公共部分统一存放方式</a></li>
    </ul>
  </li>
  <li><a href="#数据处理">数据处理</a>
    <ul>
      <li><a href="#随机数函数">随机数函数</a></li>
      <li><a href="#时间戳与时间的转换">时间戳与时间的转换</a></li>
      <li><a href="#数组按数组中的对象的key值大小排序">数组按数组中的对象的key值大小排序</a></li>
    </ul>
  </li>
  <li><a href="#往页面data中动态插入值">往页面data中动态插入值</a></li>
  <li><a href="#自己写左滑删除组件">自己写左滑删除组件</a>
    <ul>
      <li><a href="#关于ios页面会上下滑动可能会干扰左右滑的解决办法">关于ios页面会上下滑动可能会干扰左右滑的解决办法</a></li>
    </ul>
  </li>
  <li><a href="#页面悬浮球">页面悬浮球</a></li>
  <li><a href="#自己写的验证码输入框">自己写的验证码输入框</a></li>
  <li><a href="#循环请求地址的异步问题">循环请求地址的异步问题</a></li>
</ol>

<h2 id="小程序的坑坑洼洼">小程序的坑坑洼洼</h2>

<p>​	关于小程序的坑，偶遇过程都是隐性的，在你的不知不觉中就会显现出来。</p>

<h3 id="小程序的请求地址">小程序的请求地址</h3>

<p>​	小程序是个前端开发框架，不可避免的会与后台进行数据的交互。关于请求地址，小程序官方为了数据的安全性，给了一个硬性的要求 ——</p>

<p><code class="highlighter-rouge">1、开发可以使用http，但是必须在开发工具中开启不校验，开发完成后手机微信端查看效果必须点击右上角打开调试 </code></p>

<p><img src="http://i4.bvimg.com/663328/3bf84c499760bcdc.png" alt="Markdown" /></p>

<p><code class="highlighter-rouge">2、上线要求，必须为 https</code></p>

<h4 id="关于请求地址的公共部分统一存放方式">关于请求地址的公共部分统一存放方式</h4>

<p>​	在根目录下的 app.js 里添加公共变量：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">App</span><span class="p">({</span>
    <span class="na">https</span><span class="p">:</span> <span class="s2">"https://**.***.**"</span>
<span class="p">})</span>
</code></pre></div></div>

<p>​	在其他需要请求的页面的 js 内引入这个变量</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">getApp</span><span class="p">();</span>

<span class="nx">wx</span><span class="p">.</span><span class="nx">request</span><span class="p">({</span>
  <span class="na">url</span><span class="p">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">https</span> <span class="o">+</span> <span class="s2">"/***"</span><span class="p">,</span>
  <span class="na">method</span><span class="p">:</span> <span class="s2">"POST"</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
  <span class="p">},</span>
  <span class="na">header</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'Content-Type'</span><span class="p">:</span> <span class="s1">'application/json'</span>
  <span class="p">},</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="na">fail</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">wx</span><span class="p">.</span><span class="nx">showToast</span><span class="p">({</span>
      <span class="na">title</span><span class="p">:</span> <span class="s1">'网络连接失败'</span><span class="p">,</span>
      <span class="na">duration</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
      <span class="na">icon</span><span class="p">:</span> <span class="s1">'none'</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<h3 id="数据处理">数据处理</h3>

<p>​	拿到数据后，对数据的处理有一些心得。</p>

<h4 id="随机数函数">随机数函数</h4>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">randomNum</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">num1</span><span class="p">,</span> <span class="nx">num2</span><span class="p">){</span>
    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="nx">num2</span> <span class="o">-</span> <span class="nx">num1</span><span class="p">)</span> <span class="o">+</span> <span class="nx">num1</span><span class="p">;</span>
<span class="p">},</span>
</code></pre></div></div>

<h4 id="时间戳与时间的转换">时间戳与时间的转换</h4>

<p>时间转时间戳：</p>

<blockquote>
  <p>一大巨坑，ios的时间如果有横岗 则无法转为标准时间，则无法转为时间戳，需要将 ‘ - ‘ 替换成 ‘ / ‘</p>

  <p>不行： 2018-09-26          可以： 2018/09/26</p>
</blockquote>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 如果借口请求拿到时间 2018-09-26 14:34:07 ， 现在需要将它转成时间戳</span>
<span class="nx">Page</span><span class="p">({</span>
    <span class="nx">data</span><span class="p">{</span>
    	<span class="na">time</span><span class="p">:</span> <span class="s1">'2018-09-26 14:34:07'</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="nl">timeToTimestamp</span><span class="p">:</span><span class="kd">function</span><span class="p">(){</span>
		<span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    	<span class="c1">// 强行用 '/' 取代字符串中的 '-'</span>
        <span class="kd">var</span> <span class="nx">newTime</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="sr">/-/gm</span><span class="p">),</span> <span class="s2">"/"</span><span class="p">);</span>
    	<span class="c1">// 获取标准时间</span>
    	<span class="kd">var</span> <span class="nx">standard</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">newTime</span><span class="p">);</span>
    	<span class="c1">// 时间转时间戳</span>
    	<span class="kd">var</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="nx">standard</span><span class="p">.</span><span class="nx">getTime</span><span class="p">();</span>
    	
    	<span class="c1">// timestamp 就是时间戳</span>
    	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">timestamp</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">})</span>
</code></pre></div></div>

<p>当前时间转时间戳：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Page</span><span class="p">({</span>
	<span class="na">onLoad</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 获取当前时间的标准时间</span>
        <span class="kd">var</span> <span class="nx">nowTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
        <span class="c1">// 时间转时间戳</span>
    	<span class="kd">var</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="nx">nowTime</span><span class="p">.</span><span class="nx">getTime</span><span class="p">();</span>
        
        <span class="c1">// timestamp 就是时间戳</span>
    	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">timestamp</span><span class="p">);</span>
	<span class="p">},</span>
<span class="p">})</span>
</code></pre></div></div>

<p>时间戳转时间：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 时间戳转时间</span>
<span class="nx">timestampToTime</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">timestamp</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">timestamp</span><span class="p">);</span><span class="c1">//时间戳为10位需*1000，时间戳为13位的话不需乘1000</span>
    <span class="kd">var</span> <span class="nx">Y</span> <span class="o">=</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span> <span class="o">+</span> <span class="s1">'-'</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">M</span> <span class="o">=</span> <span class="p">(</span><span class="nx">date</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="p">?</span> <span class="s1">'0'</span> <span class="o">+</span> <span class="p">(</span><span class="nx">date</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'-'</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">D</span> <span class="o">=</span> <span class="p">(</span><span class="nx">date</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="p">?</span> <span class="s1">'0'</span> <span class="o">+</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span> <span class="p">:</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getDate</span><span class="p">())</span> <span class="o">+</span> <span class="s1">' '</span><span class="p">;</span>
    <span class="c1">// var D = date.getDate() + ' ';</span>
    <span class="kd">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="p">(</span><span class="nx">date</span><span class="p">.</span><span class="nx">getHours</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="p">?</span> <span class="s1">'0'</span> <span class="o">+</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getHours</span><span class="p">()</span> <span class="p">:</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getHours</span><span class="p">())</span> <span class="o">+</span> <span class="s1">':'</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="p">(</span><span class="nx">date</span><span class="p">.</span><span class="nx">getMinutes</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="p">?</span> <span class="s1">'0'</span> <span class="o">+</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getMinutes</span><span class="p">()</span> <span class="p">:</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getMinutes</span><span class="p">())</span> <span class="o">+</span> <span class="s1">':'</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="p">(</span><span class="nx">date</span><span class="p">.</span><span class="nx">getSeconds</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="p">?</span> <span class="s1">'0'</span> <span class="o">+</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getSeconds</span><span class="p">()</span> <span class="p">:</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getSeconds</span><span class="p">());</span>
    <span class="k">return</span> <span class="nx">Y</span> <span class="o">+</span> <span class="nx">M</span> <span class="o">+</span> <span class="nx">D</span> <span class="o">+</span> <span class="nx">h</span> <span class="o">+</span> <span class="nx">m</span> <span class="o">+</span> <span class="nx">s</span><span class="p">;</span>
    <span class="c1">// return Y + M + D;</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="数组按数组中的对象的key值大小排序">数组按数组中的对象的key值大小排序</h4>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Page</span><span class="p">({</span>
    <span class="na">data</span><span class="p">:{</span>
        <span class="na">test</span><span class="p">:[</span>
            <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="s1">'徐金琦'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="s1">'22'</span> <span class="p">},</span>
            <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">55</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="s1">'徐金琦'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="s1">'22'</span> <span class="p">},</span>
            <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="s1">'徐金琦'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="s1">'22'</span> <span class="p">},</span>
            <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="s1">'徐金琦'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="s1">'22'</span> <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="na">onLoad</span><span class="p">:</span><span class="kd">function</span><span class="p">(){</span>
    	<span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="c1">// 按key值id排序</span>
        <span class="kd">var</span> <span class="nx">test</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">sortKey</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">test</span><span class="p">)</span>
    <span class="p">},</span>
    
    <span class="c1">// 按 key 值排序的函数</span>
    <span class="na">sortKey</span><span class="p">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 其中的 id 即为对应的 key 的名称</span>
        <span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">id</span> <span class="o">&gt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">id</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="c1">// 结果：</span>
<span class="c1">//    test:[</span>
<span class="c1">//        { id: 2, name: '徐金琦', age: '22' },</span>
<span class="c1">//        { id: 3, name: '徐金琦', age: '22' },</span>
<span class="c1">//        { id: 34, name: '徐金琦', age: '22' },</span>
<span class="c1">//        { id: 55, name: '徐金琦', age: '22' }</span>
<span class="c1">//    ]</span>

<span class="c1">// 写法二：</span>
<span class="na">onLoad</span><span class="p">:</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="c1">// 按key值id排序</span>
    <span class="kd">var</span> <span class="nx">test</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 其中的 id 即为对应的 key 的名称</span>
        <span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">id</span> <span class="o">&gt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">id</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">test</span><span class="p">)</span>
<span class="p">},</span>
</code></pre></div></div>

<h3 id="往页面data中动态插入值">往页面data中动态插入值</h3>

<p>​	假设需要插入的数据为某一个数组的某个索引下的值</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Page</span><span class="p">({</span>
    <span class="na">data</span><span class="p">:{</span>
        <span class="na">test</span><span class="p">:[</span>
            <span class="p">{</span><span class="na">id</span><span class="p">:</span><span class="s1">''</span><span class="p">,</span><span class="na">name</span><span class="p">:</span><span class="s1">'徐金琦'</span><span class="p">,</span><span class="na">age</span><span class="p">:</span><span class="s1">'22'</span><span class="p">},</span>            
            <span class="p">{</span><span class="na">id</span><span class="p">:</span><span class="s1">''</span><span class="p">,</span><span class="na">name</span><span class="p">:</span><span class="s1">'徐金琦'</span><span class="p">,</span><span class="na">age</span><span class="p">:</span><span class="s1">'22'</span><span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="na">onLoad</span><span class="p">:</span><span class="kd">function</span><span class="p">(){</span>
    	<span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">that</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 声明一个动态字符串代表 某个索引下的 id ********</span>
            <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="s1">'test['</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="s1">'].id'</span><span class="p">;</span>
            <span class="c1">// *****************************************</span>
            <span class="nx">that</span><span class="p">.</span><span class="nx">setData</span><span class="p">({</span>
            	<span class="p">[</span><span class="nx">id</span><span class="p">]:</span> <span class="nx">i</span>
            <span class="p">})</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">})</span>

<span class="c1">// 结果：</span>
<span class="c1">//    test:[</span>
<span class="c1">//        {id:0,name:'徐金琦',age:'22'},            </span>
<span class="c1">//        {id:1,name:'徐金琦',age:'22'}</span>
<span class="c1">//    ]</span>
</code></pre></div></div>

<h3 id="自己写左滑删除组件">自己写左滑删除组件</h3>

<p>​	在小程序应用中，有场景需要用到左滑出现删除按钮，类似微信的删除聊天的操作逻辑。</p>

<p>​	可是找遍的微信的官方组件也没能找到这方面的资料，所以只好在网上查找资料，自己写一个类似的组件。</p>

<p>先看效果：</p>

<p><img src="http://i2.bvimg.com/663328/fe17db03b524909f.gif" alt="Markdown" /></p>

<p>wxml：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;view</span> <span class="na">class=</span><span class="s">"body"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;view</span> <span class="na">class=</span><span class="s">"touchItem "</span> <span class="na">data-index=</span><span class="s">""</span> <span class="na">bindtouchstart=</span><span class="s">"touchstart"</span> <span class="na">bindtouchmove=</span><span class="s">"touchmove"</span> <span class="na">bindtouchend=</span><span class="s">"touchend"</span> <span class="na">wx:for=</span><span class="s">""</span> <span class="na">wx:key=</span><span class="s">""</span><span class="nt">&gt;</span>
    <span class="nt">&lt;view</span> <span class="na">class=</span><span class="s">"contentArea"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;text</span> <span class="na">class=</span><span class="s">"title"</span><span class="nt">&gt;&lt;/text&gt;</span>
    <span class="nt">&lt;/view&gt;</span>
    <span class="nt">&lt;view</span> <span class="na">class=</span><span class="s">"del"</span> <span class="na">catchtap=</span><span class="s">"ignore"</span> <span class="na">data-index=</span><span class="s">""</span><span class="nt">&gt;</span>删除<span class="nt">&lt;/view&gt;</span>
  <span class="nt">&lt;/view&gt;</span>
<span class="nt">&lt;/view&gt;</span>
</code></pre></div></div>

<p>wxss：</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">page</span><span class="p">{</span>
  <span class="nl">box-sizing</span><span class="p">:</span> <span class="n">border-box</span><span class="p">;</span>
  <span class="nl">padding-top</span><span class="p">:</span> <span class="m">20</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">background</span><span class="p">:</span><span class="n">rgba</span><span class="p">(</span><span class="m">244</span><span class="p">,</span><span class="m">249</span><span class="p">,</span><span class="m">255</span><span class="p">,</span><span class="m">1</span><span class="p">);</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.body</span><span class="p">{</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">overflow-y</span><span class="p">:</span> <span class="nb">scroll</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.touchItem</span> <span class="p">{</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">14px</span><span class="p">;</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>
  <span class="nl">justify-content</span><span class="p">:</span> <span class="n">space-between</span><span class="p">;</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">120</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">margin-bottom</span><span class="p">:</span> <span class="m">20</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">border-bottom</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="m">#eee</span><span class="p">;</span>
  <span class="nl">overflow-x</span><span class="p">:</span> <span class="nb">hidden</span><span class="p">;</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="no">white</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.contentArea</span> <span class="p">{</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">10px</span> <span class="m">20</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">line-height</span><span class="p">:</span> <span class="m">22px</span><span class="p">;</span>
  <span class="nl">margin-right</span><span class="p">:</span><span class="m">0</span><span class="p">;</span>
  <span class="nl">-webkit-transition</span><span class="p">:</span> <span class="n">all</span> <span class="m">0.4s</span><span class="p">;</span>
  <span class="nl">transition</span><span class="p">:</span> <span class="n">all</span> <span class="m">0.4s</span><span class="p">;</span>
  <span class="nl">-webkit-transform</span><span class="p">:</span> <span class="n">translateX</span><span class="p">(</span><span class="m">70px</span><span class="p">);</span>
  <span class="nl">transform</span><span class="p">:</span> <span class="n">translateX</span><span class="p">(</span><span class="m">70px</span><span class="p">);</span>
  <span class="nl">margin-left</span><span class="p">:</span> <span class="m">-70px</span>
<span class="p">}</span>
<span class="nc">.title</span><span class="p">{</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">30</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#333</span><span class="p">;</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>
  <span class="nl">float</span><span class="p">:</span> <span class="nb">left</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.del</span> <span class="p">{</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="m">#FD5454</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">70px</span><span class="p">;</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>
  <span class="nl">flex-direction</span><span class="p">:</span> <span class="n">column</span><span class="p">;</span>
  <span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
  <span class="nl">justify-content</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#fff</span><span class="p">;</span>
  <span class="nl">-webkit-transform</span><span class="p">:</span> <span class="n">translateX</span><span class="p">(</span><span class="m">70px</span><span class="p">);</span>
  <span class="nl">transform</span><span class="p">:</span> <span class="n">translateX</span><span class="p">(</span><span class="m">70px</span><span class="p">);</span>
  <span class="nl">-webkit-transition</span><span class="p">:</span> <span class="n">all</span> <span class="m">0.4s</span><span class="p">;</span>
  <span class="nl">transition</span><span class="p">:</span> <span class="n">all</span> <span class="m">0.4s</span><span class="p">;</span>
<span class="p">}</span>

<span class="c">/* 左滑后的样式 */</span>
<span class="nc">.touch-move-active</span> <span class="nc">.contentArea</span><span class="o">,</span>
<span class="nc">.touch-move-active</span> <span class="nc">.del</span> <span class="p">{</span>
  <span class="nl">-webkit-transform</span><span class="p">:</span> <span class="n">translateX</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
  <span class="nl">transform</span><span class="p">:</span> <span class="n">translateX</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>js：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Page</span><span class="p">({</span>

    <span class="cm">/**
    * 页面的初始数据
    */</span>
    <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">test</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'这是测试'</span> <span class="p">},</span>
            <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'这是测试'</span> <span class="p">},</span>
            <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'这是测试'</span> <span class="p">},</span>
            <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'这是测试'</span> <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>

    <span class="c1">//手指触摸动作开始 记录起点X坐标</span>
    <span class="na">touchstart</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//开始触摸时 重置所有删除</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">isTouchMove</span><span class="p">)</span><span class="c1">//只操作为true的</span>
                <span class="nx">v</span><span class="p">.</span><span class="nx">isTouchMove</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">})</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setData</span><span class="p">({</span>
            <span class="na">startX</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">changedTouches</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">clientX</span><span class="p">,</span>
            <span class="na">startY</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">changedTouches</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">clientY</span><span class="p">,</span>
            <span class="na">test</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">test</span>
        <span class="p">})</span>
    <span class="p">},</span>
    <span class="c1">//滑动事件处理</span>
    <span class="na">touchmove</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
        <span class="nx">index</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">index</span><span class="p">,</span> <span class="c1">//当前索引</span>
        <span class="nx">startX</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">startX</span><span class="p">,</span> <span class="c1">//开始X坐标</span>
        <span class="nx">startY</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">startY</span><span class="p">,</span> <span class="c1">//开始Y坐标</span>
        <span class="nx">touchMoveX</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">changedTouches</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">clientX</span><span class="p">,</span> <span class="c1">//滑动变化坐标</span>
        <span class="nx">touchMoveY</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">changedTouches</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">clientY</span><span class="p">,</span> <span class="c1">//滑动变化坐标</span>
        <span class="c1">//获取滑动角度</span>
        <span class="nx">angle</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">angle</span><span class="p">({</span> <span class="na">X</span><span class="p">:</span> <span class="nx">startX</span><span class="p">,</span> <span class="na">Y</span><span class="p">:</span> <span class="nx">startY</span> <span class="p">},</span> <span class="p">{</span> <span class="na">X</span><span class="p">:</span> <span class="nx">touchMoveX</span><span class="p">,</span> <span class="na">Y</span><span class="p">:</span> <span class="nx">touchMoveY</span> <span class="p">});</span>
        
        <span class="nx">that</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">v</span><span class="p">.</span><span class="nx">isTouchMove</span> <span class="o">=</span> <span class="kc">false</span>
            <span class="c1">//滑动超过30度角 return </span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">angle</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">==</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">touchMoveX</span> <span class="o">&gt;</span> <span class="nx">startX</span><span class="p">)</span> <span class="c1">//右滑</span>
                    <span class="nx">v</span><span class="p">.</span><span class="nx">isTouchMove</span> <span class="o">=</span> <span class="kc">false</span>
                <span class="k">else</span> <span class="c1">//左滑</span>
                    <span class="nx">v</span><span class="p">.</span><span class="nx">isTouchMove</span> <span class="o">=</span> <span class="kc">true</span>
            <span class="p">}</span>
        <span class="p">})</span>
        <span class="c1">//更新数据</span>
        <span class="nx">that</span><span class="p">.</span><span class="nx">setData</span><span class="p">({</span>
        <span class="na">test</span><span class="p">:</span> <span class="nx">that</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">test</span>
        <span class="p">})</span>
    <span class="p">},</span>
    <span class="c1">// 触碰结束</span>
    <span class="na">touchend</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">that</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">showDel</span> <span class="o">=</span> <span class="s1">'test['</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="s1">'].showDel'</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">test</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">isTouchMove</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">setData</span><span class="p">({</span>
                <span class="p">[</span><span class="nx">showDel</span><span class="p">]:</span> <span class="kc">true</span>
                <span class="p">})</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">setData</span><span class="p">({</span>
                    <span class="p">[</span><span class="nx">showDel</span><span class="p">]:</span> <span class="kc">false</span>
                <span class="p">})</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="cm">/**
    * 计算滑动角度
    * @param {Object} start 起点坐标
    * @param {Object} end 终点坐标
    */</span>
    <span class="na">angle</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">_X</span> <span class="o">=</span> <span class="nx">end</span><span class="p">.</span><span class="nx">X</span> <span class="o">-</span> <span class="nx">start</span><span class="p">.</span><span class="nx">X</span><span class="p">,</span>
        	<span class="nx">_Y</span> <span class="o">=</span> <span class="nx">end</span><span class="p">.</span><span class="nx">Y</span> <span class="o">-</span> <span class="nx">start</span><span class="p">.</span><span class="nx">Y</span><span class="p">;</span>
        <span class="c1">//返回角度 /Math.atan()返回数字的反正切值</span>
        <span class="k">return</span> <span class="mi">360</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">atan</span><span class="p">(</span><span class="nx">_Y</span> <span class="o">/</span> <span class="nx">_X</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="c1">//删除通知</span>
    <span class="na">ignore</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">delIndex</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">index</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">delIndex</span><span class="p">)</span>
    <span class="p">},</span>

<span class="p">})</span>
</code></pre></div></div>

<p>​	以上代码，复制直接用即可。实际使用，只需将 <strong>data</strong> 中的 <strong>test</strong> 数组修改为<strong>自己接口所得的数据</strong>。然后，在页面上直接绑定数据即可。</p>

<h4 id="关于ios页面会上下滑动可能会干扰左右滑的解决办法">关于ios页面会上下滑动可能会干扰左右滑的解决办法</h4>

<blockquote>
  <p>在页面  <strong>json</strong> 中添加下面的这句话禁用页面滚动</p>

  <p>​	<code class="highlighter-rouge">"disableScroll": true</code></p>

  <p>在页面最底层套一个大的 <strong>view</strong>，并为 <strong>page</strong> 设置宽高均为 <strong>100%</strong>，这个 <strong>view</strong> 的宽高也为 <strong>100%</strong>，然后为 <strong>view</strong> 设置</p>

  <p>​	<code class="highlighter-rouge">overflow-y: scroll;</code></p>
</blockquote>

<h3 id="页面悬浮球">页面悬浮球</h3>

<p>​	同样的，由于小程序的右上角被微信的组件所占用（现在具体能不能改，我还真不知道）。可是当页面上已经存在了相对和谐的布局以后，突然觉得必须要给页面添加一个搜索或者其他什么按钮时，你看会觉得放在那里都不合适。就在这时候，可能添加一个悬浮的小球，会给页面一种不一样的感觉。既不会打破页面的和谐，也可以让用户自己随意拖动到页面的某个地方并悬停在屏幕的边缘处。</p>

<p>​	或许用户并不太喜欢这个按钮，后期我会再次修改这个悬浮球的相应逻辑，给用户更好的操作体验。暂时的想法是 让悬浮球隐藏在页面边缘，露出一点点边缘，用户可点击，则弹出。</p>

<p>先看效果：</p>

<p><img src="http://i4.bvimg.com/663328/6cb9c7e84aeaf5ca.gif" alt="Markdown" /></p>

<p>关于代码：</p>

<p><strong>wxml:</strong></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;view</span> <span class="na">class=</span><span class="s">"btn"</span> <span class="na">style=</span><span class="s">"bottom:px;right:px;"</span> <span class="na">bindtouchmove=</span><span class="s">"ballMoveEvent"</span> <span class="na">bindtouchend=</span><span class="s">"ballMoveEnd"</span><span class="nt">&gt;</span>悬浮<span class="nt">&lt;/view&gt;</span>
</code></pre></div></div>

<p><strong>wxss:</strong></p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.btn</span><span class="p">{</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">50px</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">50px</span><span class="p">;</span>
  <span class="nl">border-radius</span><span class="p">:</span> <span class="m">50%</span><span class="p">;</span>
  <span class="nl">box-sizing</span><span class="p">:</span> <span class="n">border-box</span><span class="p">;</span>
  <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
  <span class="nl">line-height</span><span class="p">:</span> <span class="m">50px</span><span class="p">;</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">30</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="no">white</span><span class="p">;</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">fixed</span><span class="p">;</span>
  <span class="nl">bottom</span><span class="p">:</span> <span class="m">350</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">right</span><span class="p">:</span> <span class="m">5px</span><span class="p">;</span>
  <span class="c">/* right: calc( 100% - 60px ); */</span>  
  <span class="nl">background-color</span><span class="p">:</span> <span class="m">#6d75f4</span><span class="p">;</span>  
  <span class="nl">box-shadow</span><span class="p">:</span>  <span class="m">1px</span> <span class="m">1px</span> <span class="m">2px</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0.2</span><span class="p">);</span>   
  <span class="nl">z-index</span><span class="p">:</span> <span class="m">100</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>js:</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">onLoad</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="c1">// 获取屏幕宽高</span>
    <span class="nx">wx</span><span class="p">.</span><span class="nx">getSystemInfo</span><span class="p">({</span>
        <span class="na">success</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">that</span><span class="p">.</span><span class="nx">setData</span><span class="p">({</span>
                <span class="na">screenHeight</span><span class="p">:</span> <span class="nx">res</span><span class="p">.</span><span class="nx">windowHeight</span><span class="p">,</span>
                <span class="na">screenWidth</span><span class="p">:</span> <span class="nx">res</span><span class="p">.</span><span class="nx">windowWidth</span><span class="p">,</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">},</span>
<span class="na">ballMoveEvent</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="c1">// console.log('我被拖动了....');</span>
    <span class="kd">var</span> <span class="nx">touchs</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">pageX</span> <span class="o">=</span> <span class="nx">touchs</span><span class="p">.</span><span class="nx">pageX</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">pageY</span> <span class="o">=</span> <span class="nx">touchs</span><span class="p">.</span><span class="nx">pageY</span><span class="p">;</span>
    <span class="c1">// console.log('pageX: ' + pageX)</span>
    <span class="c1">// console.log('pageY: ' + pageY)</span>
    
    <span class="c1">//防止坐标越界,view宽高的一般</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pageX</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pageX</span> <span class="o">&gt;</span> <span class="nx">that</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">screenWidth</span> <span class="o">-</span> <span class="mi">30</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">screenHeight</span> <span class="o">-</span> <span class="nx">pageY</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pageY</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="c1">//这里用right和bottom.所以需要将pageX pageY转换</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">screenWidth</span> <span class="o">-</span> <span class="nx">pageX</span> <span class="o">-</span> <span class="mi">30</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">screenHeight</span> <span class="o">-</span> <span class="nx">pageY</span> <span class="o">-</span> <span class="mi">30</span><span class="p">;</span>
    <span class="c1">// console.log('x: ' + x)</span>
    <span class="c1">// console.log('y: ' + y)</span>
    <span class="nx">that</span><span class="p">.</span><span class="nx">setData</span><span class="p">({</span>
        <span class="na">ballBottom</span><span class="p">:</span> <span class="nx">y</span><span class="p">,</span>
        <span class="na">ballRight</span><span class="p">:</span> <span class="nx">x</span>
    <span class="p">});</span>
<span class="p">},</span>
<span class="na">ballMoveEnd</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"我停止接触了"</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">ballRight</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">screenWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">25</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">that</span><span class="p">.</span><span class="nx">setData</span><span class="p">({</span>
        	<span class="na">ballRight</span><span class="p">:</span> <span class="nx">that</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">screenWidth</span> <span class="o">-</span> <span class="mi">55</span>
        <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">that</span><span class="p">.</span><span class="nx">setData</span><span class="p">({</span>
            <span class="na">ballRight</span><span class="p">:</span> <span class="mi">5</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">},</span>
</code></pre></div></div>

<p>​	复制上述代码并在相应的地方粘贴便可以看到悬浮球的效果。关于修改悬浮球的大小，单位为 <strong>px</strong>，修改完大小后，记得在 js 中也修改相关的悬停位置， 单位同样也是 <strong>px</strong>。</p>

<h3 id="自己写的验证码输入框">自己写的验证码输入框</h3>

<blockquote>
  <p><strong>业务场景</strong>：当用户点击确定后，向后台请求并收到一条带有验证码的短信。此时输入验证码即可进行下一步。</p>
</blockquote>

<p>思路：</p>

<p>​	想要在弹出框中输入验证码，且验证码位置无光标显示，以保证美观。</p>

<p>​	所以，将 输入框 用定位移出到屏幕外，当弹出验证码输入的弹出框时，自动将输入框变为 <strong>有焦点</strong> 状态。在弹出框内预留六个框，每个框绑定一个输入框内输入的数值。每个框绑定一个点击事件，点击框后自动时屏幕外的输入框 <strong>有焦点</strong>。</p>

<p>先看效果：</p>

<p><img src="http://i1.bvimg.com/663328/40f3ae080de8b8fc.gif" alt="Markdown" /></p>

<p>关于代码：</p>

<p>wxml：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- 点击按钮，弹出输入框 --&gt;</span>
<span class="nt">&lt;view</span> <span class="na">class=</span><span class="s">"btn"</span> <span class="na">bindtap=</span><span class="s">"showSureCode"</span><span class="nt">&gt;</span>点击输入验证码<span class="nt">&lt;/view&gt;</span>

<span class="c">&lt;!-- 验证码弹窗 --&gt;</span>
<span class="nt">&lt;view</span> <span class="na">class=</span><span class="s">"back"</span> <span class="na">hidden=</span><span class="s">''</span><span class="nt">&gt;</span> 
  <span class="nt">&lt;view</span> <span class="na">class=</span><span class="s">"sureCode"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;text</span> <span class="na">class=</span><span class="s">"sureCode-title"</span><span class="nt">&gt;</span>输入验证码<span class="nt">&lt;/text&gt;</span>
    <span class="nt">&lt;view</span> <span class="na">class=</span><span class="s">"inputLine"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;view</span> <span class="na">class=</span><span class="s">"inputBlock"</span> <span class="na">bindtap=</span><span class="s">"inputFocus"</span><span class="nt">&gt;&lt;/view&gt;</span>
      <span class="nt">&lt;view</span> <span class="na">class=</span><span class="s">"inputBlock"</span> <span class="na">bindtap=</span><span class="s">"inputFocus"</span><span class="nt">&gt;&lt;/view&gt;</span>
      <span class="nt">&lt;view</span> <span class="na">class=</span><span class="s">"inputBlock"</span> <span class="na">bindtap=</span><span class="s">"inputFocus"</span><span class="nt">&gt;&lt;/view&gt;</span>
      <span class="nt">&lt;view</span> <span class="na">class=</span><span class="s">"inputBlock"</span> <span class="na">bindtap=</span><span class="s">"inputFocus"</span><span class="nt">&gt;&lt;/view&gt;</span>
      <span class="nt">&lt;view</span> <span class="na">class=</span><span class="s">"inputBlock"</span> <span class="na">bindtap=</span><span class="s">"inputFocus"</span><span class="nt">&gt;&lt;/view&gt;</span>
      <span class="nt">&lt;view</span> <span class="na">class=</span><span class="s">"inputBlock"</span> <span class="na">bindtap=</span><span class="s">"inputFocus"</span><span class="nt">&gt;&lt;/view&gt;</span>
    <span class="nt">&lt;/view&gt;</span>
    <span class="nt">&lt;text</span> <span class="na">class=</span><span class="s">"cancel"</span> <span class="na">bindtap=</span><span class="s">"cancel"</span><span class="nt">&gt;</span>取 消<span class="nt">&lt;/text&gt;</span>
    <span class="nt">&lt;text</span> <span class="na">class=</span><span class="s">"sure"</span> <span class="na">bindtap=</span><span class="s">"sure"</span><span class="nt">&gt;</span>确 认<span class="nt">&lt;/text&gt;</span>
  <span class="nt">&lt;/view&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"ainput"</span> <span class="na">type=</span><span class="s">"number"</span> <span class="na">bindinput=</span><span class="s">"input"</span> <span class="na">focus=</span><span class="s">""</span> <span class="na">maxlength=</span><span class="s">'6'</span><span class="nt">&gt;&lt;/input&gt;</span>
<span class="nt">&lt;/view&gt;</span>
</code></pre></div></div>

<p>wxss：</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">/* 按钮 */</span>
<span class="nc">.btn</span><span class="p">{</span>
  <span class="nl">width</span><span class="p">:</span><span class="m">600</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">height</span><span class="p">:</span><span class="m">100</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">background</span><span class="p">:</span> <span class="n">linear-gradient</span><span class="p">(</span><span class="n">to</span> <span class="nb">right</span><span class="p">,</span> <span class="m">#b663f9</span> <span class="p">,</span> <span class="m">#6d75f4</span><span class="p">);</span>   
  <span class="nl">border-radius</span><span class="p">:</span><span class="m">10</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="no">white</span><span class="p">;</span>
  <span class="nl">line-height</span><span class="p">:</span> <span class="m">100</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="m">70</span><span class="n">rpx</span> <span class="nb">auto</span><span class="p">;</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">30</span><span class="n">rpx</span><span class="p">;</span>
<span class="p">}</span>
<span class="c">/* 弹窗 */</span>
<span class="nc">.back</span><span class="p">{</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">fixed</span><span class="p">;</span>
  <span class="nl">bottom</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">.3</span><span class="p">);</span>
<span class="p">}</span>
<span class="nc">.sureCode</span><span class="p">{</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">400</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">650</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="no">white</span><span class="p">;</span>
  <span class="nl">border-radius</span><span class="p">:</span> <span class="m">10</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">relative</span><span class="p">;</span>
  <span class="nl">left</span><span class="p">:</span> <span class="n">calc</span><span class="p">(</span> <span class="m">50%</span> <span class="n">-</span> <span class="m">325</span><span class="n">rpx</span> <span class="p">);</span>
  <span class="nl">top</span><span class="p">:</span> <span class="m">30%</span><span class="p">;</span>
  <span class="nl">box-sizing</span><span class="p">:</span> <span class="n">border-box</span><span class="p">;</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">30</span><span class="n">rpx</span> <span class="m">40</span><span class="n">rpx</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.sureCode-title</span><span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>
  <span class="nl">font-size</span><span class="p">:</span><span class="m">36</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span><span class="n">rgba</span><span class="p">(</span><span class="m">51</span><span class="p">,</span><span class="m">51</span><span class="p">,</span><span class="m">51</span><span class="p">,</span><span class="m">1</span><span class="p">);</span>
  <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
  <span class="nl">margin-bottom</span><span class="p">:</span> <span class="m">20</span><span class="n">rpx</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.ainput</span><span class="p">{</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">100</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="no">white</span><span class="p">;</span>
  <span class="nl">top</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">left</span><span class="p">:</span> <span class="m">-10000px</span><span class="p">;</span>
  <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.inputLine</span><span class="p">{</span>
  <span class="nl">margin-top</span><span class="p">:</span> <span class="m">100</span><span class="n">rpx</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.inputBlock</span><span class="p">{</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">55</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">55</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">float</span><span class="p">:</span> <span class="nb">left</span><span class="p">;</span>
  <span class="nl">margin-right</span><span class="p">:</span> <span class="m">48</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">box-sizing</span><span class="p">:</span> <span class="n">border-box</span><span class="p">;</span>
  <span class="nl">border-bottom</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="m">#b264f8</span><span class="p">;</span>
  <span class="nl">line-height</span><span class="p">:</span> <span class="m">55</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">40</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#303030</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.inputLine</span> <span class="nt">view</span><span class="nd">:nth-child</span><span class="o">(</span><span class="nt">6</span><span class="o">)</span><span class="p">{</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.cancel</span><span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">100</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">50%</span><span class="p">;</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
  <span class="nl">bottom</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">line-height</span><span class="p">:</span> <span class="m">100</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">28</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#333333</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.sure</span><span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">100</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">50%</span><span class="p">;</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
  <span class="nl">bottom</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">right</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">line-height</span><span class="p">:</span> <span class="m">100</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">28</span><span class="n">rpx</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#FD5454</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>js：</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">data</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">sureCode</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">inputFocus</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">sureCodeNum</span><span class="p">:</span> <span class="p">[],</span>
<span class="p">},</span>
<span class="c1">// 弹出验证框</span>
<span class="nx">showSureCode</span><span class="p">:</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">that</span><span class="p">.</span><span class="nx">setData</span><span class="p">({</span>
        <span class="na">sureCode</span><span class="p">:</span> <span class="kc">false</span>
    <span class="p">})</span>
<span class="p">},</span>
<span class="c1">// 输入框的焦点问题</span>
<span class="nx">inputFocus</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">that</span><span class="p">.</span><span class="nx">setData</span><span class="p">({</span>
        <span class="na">inputFocus</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">})</span>
<span class="p">},</span>
<span class="c1">// 输入框输入值后的数据处理</span>
<span class="nx">input</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">detail</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">sureCodeNum</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sureCodeNum</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">that</span><span class="p">.</span><span class="nx">setData</span><span class="p">({</span>
        <span class="na">sureCodeNum</span><span class="p">:</span> <span class="nx">sureCodeNum</span>
    <span class="p">})</span>
<span class="p">},</span>
<span class="c1">// 取消输入</span>
<span class="nx">cancel</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">that</span><span class="p">.</span><span class="nx">setData</span><span class="p">({</span>
        <span class="na">sureCode</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">})</span>
<span class="p">},</span>
<span class="c1">// 确认输入</span>
<span class="nx">sure</span><span class="p">:</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">wx</span><span class="p">.</span><span class="nx">showLoading</span><span class="p">({</span>
        <span class="na">title</span><span class="p">:</span> <span class="s1">'验证中'</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="nx">wx</span><span class="p">.</span><span class="nx">hideLoading</span><span class="p">();</span>
        <span class="nx">that</span><span class="p">.</span><span class="nx">setData</span><span class="p">({</span>
            <span class="na">sureCode</span><span class="p">:</span> <span class="kc">true</span>
        <span class="p">})</span>
    <span class="p">},</span><span class="mi">1000</span><span class="p">)</span>
<span class="p">},</span>
</code></pre></div></div>

<p>具体业务场景根据需要添加具体的样式和逻辑，基础模板就参考上述代码。同样复制粘贴即可看效果。</p>

<h3 id="循环请求地址的异步问题">循环请求地址的异步问题</h3>

<blockquote>
  <p><strong>业务场景：</strong>当请求接口时，拿到了一串数组，数组里的每一个对象对应一个 <strong>id</strong> 或者其他的什么<strong>身份标识</strong>。此时页面要求显示的不是 <strong>id</strong> 而是这个 <strong>id</strong> 所对应的<strong>名字</strong>。而名字需要调用另一个接口去获取。</p>
</blockquote>

<p>思路：</p>

<p>​	通过 <strong>递归</strong> 的方式，而不能用 <strong>for</strong> 循环请求。</p>

<p>原因：</p>

<p>​	由于小程序的请求为<strong>异步请求</strong>，异步请求就存在一个程序并行的问题。而 <strong>for</strong> 循环在执行过程中，请求发送便会执行下一次的循环。当网络环境不佳时，则必然会存在多个请求并存的问题，导致请求数据的顺序并非是自己想要的那种样子。</p>

<p>​	而<strong>递归</strong>则不同，递归的意义就在于当发送一次请求之后，我们可以在请求完成以后再次调用这个 <strong>递归函数</strong> ，并将 i + 1 ，在函数内判断，当 i 满足某个条件时，结束这个递归函数。这样的请求就不会将数据顺序打乱。</p>

<p>demo：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 请求所得数据</span>
<span class="c1">// [{ id: 2, age: '22' },</span>
<span class="c1">//  { id: 55, age: '22' },</span>
<span class="c1">//  { id: 3, age: '22' },</span>
<span class="c1">//  { id: 34, age: '22' }]</span>

<span class="c1">// 页面需要的数据</span>
<span class="c1">// [{ id: 2, name:'徐金琦' , age: '22' },</span>
<span class="c1">//  { id: 55, name:'徐金琦', age: '22' },</span>
<span class="c1">//  { id: 3, name:'徐金琦', age: '22' },</span>
<span class="c1">//  { id: 34, name:'徐金琦', age: '22' }]</span>


<span class="nx">data</span><span class="p">:{</span>
    <span class="nl">test</span><span class="p">:</span> <span class="p">[],</span>
<span class="p">},</span>
<span class="nx">forTest</span><span class="p">:</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="c1">// 第一次请求拿到所有数据与对应id</span>
	<span class="nx">wx</span><span class="p">.</span><span class="nx">request</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span> <span class="s1">'https://**.**/forTest'</span><span class="p">,</span> 
        <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">a</span><span class="p">:</span><span class="s1">'**'</span><span class="p">,</span>
            <span class="na">b</span><span class="p">:</span><span class="s1">'**'</span>
        <span class="p">},</span>
        <span class="na">header</span><span class="p">:</span> <span class="p">{</span>
        	<span class="s1">'content-type'</span><span class="p">:</span> <span class="s1">'application/json'</span>
        <span class="p">},</span>
        <span class="nx">success</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
            <span class="kd">var</span> <span class="nx">test</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
            <span class="nx">that</span><span class="p">.</span><span class="nx">setData</span><span class="p">({</span>
                <span class="na">test</span><span class="p">:</span> <span class="nx">test</span>
            <span class="p">})</span>
            <span class="c1">// 触发 递归函数 </span>
            <span class="nx">that</span><span class="p">.</span><span class="nx">forName</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">fail</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">})</span>

<span class="p">},</span>
<span class="nx">forName</span><span class="p">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">){</span>
	<span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="c1">// 备份第一次请求所得数据，防止之后操作对原始数据的影响</span>
    <span class="kd">var</span> <span class="nx">testBak</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">slice</span><span class="p">();</span>
    <span class="c1">// 第二次使用对应 id 逐个请求</span>
    <span class="nx">wx</span><span class="p">.</span><span class="nx">request</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span> <span class="s1">'https://**.**/forName'</span><span class="p">,</span> 
        <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">id</span><span class="p">:</span> <span class="nx">testBak</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span>
        <span class="p">},</span>
        <span class="na">header</span><span class="p">:</span> <span class="p">{</span>
        	<span class="s1">'content-type'</span><span class="p">:</span> <span class="s1">'application/json'</span>
        <span class="p">},</span>
        <span class="nx">success</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
            <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="s1">'name'</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
            <span class="nx">testBak</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
            <span class="nx">that</span><span class="p">.</span><span class="nx">setData</span><span class="p">({</span>
                <span class="na">test</span><span class="p">:</span> <span class="nx">testBak</span>
            <span class="p">})</span>
            
            <span class="c1">// 判断再次触发递归的条件，并将 i 自增 1</span>
            <span class="k">if</span><span class="p">(</span><span class="o">++</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">testBak</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">forName</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">test</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">fail</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">})</span>
<span class="p">},</span>
</code></pre></div></div>

<p>暂时就想到这些，日后再补。</p>

<hr />

<p>最后，以上部分源码下载：</p>

<p><a href="https://github.com/xukimseven/wechat-applet">wechat-applet</a></p>

<p>最最后，打个广告，我写的完整的小程序，暂时不更新版：</p>

<p><img src="http://i1.bvimg.com/663328/279ce0dbf62bce86.png" alt="Markdown" /></p>

<hr />

<p>同样的，欢迎提意见。。。</p>

  <!-- 引入share模块 -->
  
  <div class="social-share-wrapper">
    <div class="social-share"></div>
  </div>


<!-- share.js -->
<script src="/assets/js/social-share.min.js"></script>
<script>
  socialShare('.social-share', {
    sites: [
      
        'qq'
        ,
        
      
        'wechat'
        ,
        
      
        'weibo'
        ,
        
      
        'twitter'
        ,
        
      
        'facebook'
        
      
    ],
    wechatQrcodeTitle: "分享到微信朋友圈",
    wechatQrcodeHelper: '期待在朋友圈见到这篇文章'
  });
</script>

</div>

<!-- 底部锚点 -->
<a id="htmldown" name="htmldown"></a>
<!-- 引入评论模块 -->

    <section class="post-footer-item comment">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zNDI2OS8xMDgwNg=="></div>
    </section>

    <!-- 来必力City版安装代码 -->
    <script type="text/javascript">
       (function(d, s) {
           var j, e = d.getElementsByTagName(s)[0];

           if (typeof LivereTower === 'function') { return; }

           j = d.createElement(s);
           j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
           j.async = true;

           e.parentNode.insertBefore(j, e);
       })(document, 'script');
    </script>
    <noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
    <!-- City版安装代码已完成 -->







<!-- 引入goto模块 -->
<div class="bounceInRight animated go">
  <a title="顶部切换页面" class="gototop" href="#htmlup" target="_self">
    <div class="box" style="font-family:'ffad_matroregular';">
        Top
    </div>
  </a>
  <a title="底部有| livere |评论哦" class="gotobottom" href="#htmldown" target="_self">
    <div class="box" style="font-family:'ffad_matroregular';">
        Foot
    </div>
  </a>
</div>

<!-- 引入页面底部模块 -->
<footer id="bottom">
  <br>
  <span>徐金琦的博客 ©
  
  
  2018
  <br>
  Powered by <a href="https://www.jekyll.com.cn/">Jekyll</a> | <a href="https://github.com/xukimseven/HardCandy-Jekyll">HardCandy-Jekyll</a></span>
</footer>


<!-- 引用wow.js的动画效果 -->
<script src="/assets/js/wow.js"></script>
<script>
    var wow = new WOW({
        boxClass: 'wow',
        animateClass: 'animated',
        // offset: 600,
        mobile: true,
        live: true
    });
    wow.init();
</script>
<!-- 页面刷新回到顶部 -->
<script>
    window.onbeforeunload = function(){
        //刷新后页面自动回到顶部
        document.documentElement.scrollTop = 0;  //ie下
        document.body.scrollTop = 0;  //非ie
    }
</script>
<script src="/assets/js/main.js"></script>
</body>
</html>
